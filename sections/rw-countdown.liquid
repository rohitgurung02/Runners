{%- liquid
  assign sec_id = '#shopify-section-' | append: section.id
  assign parts = sec_id | split: '_'
  assign last_lower = parts | last
  assign last_part = last_lower | downcase
-%}

<style>
  {{ sec_id }} .pc-card-carousel-{{ last_part }} {
    position: relative;
    width: 100%;
    overflow: hidden;
  }
  {{ sec_id }} .pc-card-{{ last_part }} {
    border: none;
    box-shadow: {% if section.settings.enable_shadow %}var(--bs-box-shadow-lg){% else %}none{% endif %};
    margin-bottom: {{ section.settings.card_margin_bottom }}px;
  }
  {{ sec_id }} .pc-card-body-{{ last_part }} {
    padding: {{ section.settings.card_padding }}px;
  }
  {{ sec_id }} .pc-card-subtitle-{{ last_part }} {
    font-size: {{ section.settings.subtitle_font_size }}px;
    color: {{ section.settings.subtitle_color }};
    margin-bottom: {{ section.settings.subtitle_margin_bottom }}px;
  }
  {{ sec_id }} .pc-card-title-{{ last_part }} {
    font-size: {{ section.settings.title_font_size }}px;
    color: {{ section.settings.title_color }};
    margin-bottom: {{ section.settings.title_margin_bottom }}px;
  }
  {{ sec_id }} .pc-card-text-{{ last_part }} {
    font-size: {{ section.settings.text_font_size }}px;
    color: {{ section.settings.text_color }};
    margin-bottom: {{ section.settings.text_margin_bottom }}px;
  }
  {{ sec_id }} .pc-card-carousel-nav-{{ last_part }} {
    position: absolute;
    display: flex;
    justify-content: center;
    z-index: 2;
    bottom: 0;
    width: 100%;
  }
  {{ sec_id }} .pc-carousel-arrow-{{ last_part }} {
    display: flex;
    justify-content: center;
    position: relative;
    cursor: pointer;
    padding: 10px;
    fill: {{ section.settings.arrow_color }};
    background-color: {{ section.settings.arrow_bg }};
    width: 50px;
    margin: 0 2px;
  }
  {{ sec_id }} .pc-carousel-arrow-{{ last_part }}:hover {
    background-color: {{ section.settings.arrow_bg_hover }};
  }
  {{ sec_id }} .pc-carousel-icon-{{ last_part }} {
    width: 24px;
    height: 24px;
  }
  {{ sec_id }} .pc-card-{{ last_part }} img {
    padding: 15px;
    object-fit: cover;
  }
  @media (min-width: 768px) {
    {{ sec_id }} .pc-card-{{ last_part }} img {
      object-fit: contain;
    }
  }
  @media (max-width: 767px) {
    {{ sec_id }} .pc-card-subtitle-{{ last_part }} {
      font-size: {{ section.settings.mobile_subtitle_font_size }}px;
    }
    {{ sec_id }} .pc-card-title-{{ last_part }} {
      font-size: {{ section.settings.mobile_title_font_size }}px;
    }
    {{ sec_id }} .pc-card-text-{{ last_part }} {
      font-size: {{ section.settings.mobile_text_font_size }}px;
    }
  }
</style>

<div class="pc-container-{{ last_part }} container mt-5">
  <div class="pc-row-{{ last_part }} row g-0">
    <div class="pc-col-{{ last_part }} col pc-card-carousel-{{ last_part }}">
      <div class="pc-card-carousel-nav-{{ last_part }} col-12 col-lg-4 g-2">
        <span id="pc-moveLeft-{{ last_part }}" class="pc-carousel-arrow-{{ last_part }}">
          <svg class="pc-carousel-icon-{{ last_part }}" viewBox="0 0 24 24">
            <path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"></path>
          </svg>
        </span>
        <span id="pc-moveRight-{{ last_part }}" class="pc-carousel-arrow-{{ last_part }}">
          <svg class="pc-carousel-icon-{{ last_part }}" viewBox="0 0 24 24">
            <path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z"></path>
          </svg>
        </span>
      </div>
      
      {% for block in section.blocks %}
        <div class="pc-card-{{ last_part }}{% if forloop.first %} pc-active-{{ last_part }}{% endif %}">
          <div class="row g-0">
            <div class="pc-col-{{ last_part }} col-lg-4 d-flex align-items-center">
              <div class="pc-card-body-{{ last_part }}">
                {% if block.settings.subtitle != blank %}
                  <h6 class="pc-card-subtitle-{{ last_part }} text-uppercase fs-6">{{ block.settings.subtitle }}</h6>
                {% endif %}
                {% if block.settings.title != blank %}
                  <h3 class="pc-card-title-{{ last_part }} display-4">{{ block.settings.title }}</h3>
                {% endif %}
                {% if block.settings.text != blank %}
                  <p class="pc-card-text-{{ last_part }}">{{ block.settings.text }}</p>
                {% endif %}
                {% if block.settings.button_label != blank and block.settings.button_link != blank %}
                  <a href="{{ block.settings.button_link }}" class="pc-card-button-{{ last_part }} btn btn-primary">{{ block.settings.button_label }}</a>
                {% endif %}
              </div>
            </div>
            <div class="pc-col-{{ last_part }} col-lg-8">
              {% if block.settings.image != blank %}
                {{ block.settings.image | image_url: width: block.settings.image.width, height: block.settings.image.height | image_tag: loading: 'lazy', preload: true, alt: block.settings.image.alt, class: 'img-fluid rounded-end' }}
              {% else %}
                {{ 'product-1' | placeholder_svg_tag: 'img-fluid rounded-end' }}
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sectionId = '{{ last_part }}';
    const items = document.querySelectorAll('{{ sec_id }} .pc-card-{{ last_part }}');
    let current = 0;
    const total = items.length;

    function initCarousel() {
      items.forEach((item, index) => {
        item.style.position = 'absolute';
        item.style.opacity = '0';
        item.style.zIndex = '0';
        item.style.transition = '0.4s all ease-in-out';
        
        if (index === 0) {
          item.style.position = 'relative';
          item.style.opacity = '1';
          item.style.zIndex = '1';
        }
      });
    }

    function setSlide(prev, next) {
      if (next >= total) next = 0;
      if (next < 0) next = total - 1;
      
      items[prev].style.position = 'absolute';
      items[prev].style.opacity = '0';
      items[prev].style.zIndex = '0';
      
      items[next].style.position = 'relative';
      items[next].style.opacity = '1';
      items[next].style.zIndex = '1';
      
      current = next;
    }

    document.getElementById('pc-moveRight-{{ last_part }}').addEventListener('click', function() {
      const prev = current;
      const next = current + 1;
      setSlide(prev, next);
    });

    document.getElementById('pc-moveLeft-{{ last_part }}').addEventListener('click', function() {
      const prev = current;
      const next = current - 1;
      setSlide(prev, next);
    });

    const cardCarousel = document.querySelector('{{ sec_id }} .pc-card-carousel-{{ last_part }}');
    let touchStartX = 0;
    let touchEndX = 0;

    cardCarousel.addEventListener('touchstart', function(event) {
      touchStartX = event.changedTouches[0].screenX;
    });

    cardCarousel.addEventListener('touchmove', function(event) {
      touchEndX = event.changedTouches[0].screenX;
    });

    cardCarousel.addEventListener('touchend', function() {
      if (touchEndX < touchStartX - 50) {
        const prev = current;
        const next = current + 1;
        setSlide(prev, next);
      }
      if (touchEndX > touchStartX + 50) {
        const prev = current;
        const next = current - 1;
        setSlide(prev, next);
      }
    });

    initCarousel();
  });
</script>

{% schema %}
{
  "name": "PWC - Card Carousel #1",
  "tag": "section",
  "class": "shopify-section--pc-card-carousel",
  "settings": [
    {
      "type": "header",
      "content": "Card Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_shadow",
      "label": "Enable Card Shadow",
      "default": true
    },
    {
      "type": "range",
      "id": "card_padding",
      "label": "Card Padding",
      "min": 10,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 30
    },
    {
      "type": "range",
      "id": "card_margin_bottom",
      "label": "Card Margin Bottom",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 30
    },
    {
      "type": "header",
      "content": "Subtitle Settings"
    },
    {
      "type": "range",
      "id": "subtitle_font_size",
      "label": "Font Size (Desktop)",
      "min": 10,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "mobile_subtitle_font_size",
      "label": "Font Size (Mobile)",
      "min": 10,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 12
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Color",
      "default": "#6c757d"
    },
    {
      "type": "range",
      "id": "subtitle_margin_bottom",
      "label": "Margin Bottom",
      "min": 0,
      "max": 30,
      "step": 1,
      "unit": "px",
      "default": 10
    },
    {
      "type": "header",
      "content": "Title Settings"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "label": "Font Size (Desktop)",
      "min": 16,
      "max": 72,
      "step": 1,
      "unit": "px",
      "default": 48
    },
    {
      "type": "range",
      "id": "mobile_title_font_size",
      "label": "Font Size (Mobile)",
      "min": 16,
      "max": 48,
      "step": 1,
      "unit": "px",
      "default": 32
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "title_margin_bottom",
      "label": "Margin Bottom",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 20
    },
    {
      "type": "header",
      "content": "Text Settings"
    },
    {
      "type": "range",
      "id": "text_font_size",
      "label": "Font Size (Desktop)",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "mobile_text_font_size",
      "label": "Font Size (Mobile)",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color",
      "default": "#333333"
    },
    {
      "type": "range",
      "id": "text_margin_bottom",
      "label": "Margin Bottom",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 25
    },
    {
      "type": "header",
      "content": "Navigation Arrows"
    },
    {
      "type": "color",
      "id": "arrow_color",
      "label": "Icon Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "arrow_bg",
      "label": "Background Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "arrow_bg_hover",
      "label": "Background Hover Color",
      "default": "#333333"
    }
  ],
  "blocks": [
    {
      "type": "card",
      "name": "Card",
      "settings": [
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subtitle",
          "default": "The subtitle"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Card title"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Text",
          "default": "This is a wider card with supporting text below as a natural lead-in to additional content."
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button Label",
          "default": "Learn more"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button Link"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "PWC - Card Carousel #1",
      "category": "Custom",
      "blocks": [
        {
          "type": "card",
          "settings": {
            "subtitle": "The subtitle",
            "title": "First card title",
            "text": "This is a wider card with supporting text below as a natural lead-in to additional content.",
            "button_label": "Learn more"
          }
        },
        {
          "type": "card",
          "settings": {
            "subtitle": "Another subtitle",
            "title": "Second card title",
            "text": "This is the second card with different content and text.",
            "button_label": "Read more"
          }
        }
      ]
    }
  ]
}
{% endschema %}