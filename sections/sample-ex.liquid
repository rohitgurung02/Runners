{%- style -%}
  .form-container {
    max-width: 600px;
    margin: 0 auto;
    background: white;
    padding: 2rem;
    border-radius: 1rem;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  }

  .contact-form h1 {
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    color: #111827;
  }

  .form-group {
    margin-bottom: 1.5rem;
    position: relative;
  }

  .form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
  }

  .form-group input, 
  .form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    font-size: 1rem;
    transition: all 0.15s ease;
  }

  .form-group input:focus, 
  .form-group textarea:focus {
    outline: none;
    border-color: {{ settings.colors_primary }};
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
  }

  .error-message {
    color: #dc2626;
    font-size: 0.875rem;
    margin-top: 0.25rem;
    display: none;
  }

  .validation-icon {
    position: absolute;
    right: 1rem;
    top: 2.5rem;
    display: none;
  }

  .validation-icon.success {
    color: #16a34a;
    display: block;
  }

  .validation-icon.error {
    color: #dc2626;
    display: block;
  }

  input.success, textarea.success {
    border-color: #16a34a;
  }

  input.error, textarea.error {
    border-color: #dc2626;
  }

  .checkbox-group {
    display: flex;
    align-items: start;
    gap: 0.75rem;
    margin-top: 1rem;
  }

  .checkbox-group input[type="checkbox"] {
    width: auto;
    margin-top: 0.25rem;
  }

  .checkbox-group label {
    font-size: 0.875rem;
    color: #6b7280;
  }

  .contact-form button {
    background: {{ settings.colors_primary }};
    color: white;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 0.5rem;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.15s ease;
  }

  .contact-form button:hover {
    background: {{ settings.colors_primary | color_darken: 10 }};
  }

  .privacy-notice {
    font-size: 0.875rem;
    color: #6b7280;
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid #e5e7eb;
  }

  .success-message {
    display: none;
    background: #dcfce7;
    color: #166534;
    padding: 1rem;
    border-radius: 0.5rem;
    margin-bottom: 1rem;
  }
{%- endstyle -%}

<div class="form-container contact-form">
  {% if form.posted_successfully? %}
    <div class="success-message" id="successMessage">
      Thank you! Your form has been submitted successfully.
    </div>
  {% endif %}
  
  <h1>{{ section.settings.heading | default: 'Contact Form' }}</h1>
  
  {% form 'contact', id: 'gdprForm' %}
    <div class="form-group">
      <label for="name">Full Name *</label>
      <input type="text" id="name" name="contact[name]" required>
      <span class="validation-icon">✓</span>
      <div class="error-message" id="nameError">Please enter your full name</div>
    </div>

    <div class="form-group">
      <label for="email">Email Address *</label>
      <input type="email" id="email" name="contact[email]" required>
      <span class="validation-icon">✓</span>
      <div class="error-message" id="emailError">Please enter a valid email address</div>
    </div>

    <div class="form-group">
      <label for="message">Message *</label>
      <textarea id="message" name="contact[body]" rows="4" required></textarea>
      <span class="validation-icon">✓</span>
      <div class="error-message" id="messageError">Please enter your message</div>
    </div>

    <div class="checkbox-group">
      <input type="checkbox" id="dataConsent" name="contact[data_consent]" required>
      <label for="dataConsent">
        {{ section.settings.consent_text | default: 'I consent to having this website store my submitted information so they can respond to my inquiry. See our privacy policy to learn more about how we protect and manage your submitted data. *' }}
      </label>
    </div>
    <div class="error-message" id="consentError">You must accept the privacy policy</div>

    {% if section.settings.show_marketing_opt_in %}
      <div class="checkbox-group">
        <input type="checkbox" id="marketing" name="contact[accepts_marketing]">
        <label for="marketing">
          {{ section.settings.marketing_text | default: 'I would like to receive marketing communications about your products and services' }}
        </label>
      </div>
    {% endif %}

    <button type="submit">{{ section.settings.button_text | default: 'Submit Form' }}</button>

    <div class="privacy-notice">
      <p>* Required fields</p>
      <p>{{ section.settings.privacy_text | default: 'Your personal data will be used to support your experience throughout this website, to manage access to your account, and for other purposes described in our privacy policy.' }}</p>
    </div>
  {% endform %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('gdprForm');
    
    if (form) {
      form.addEventListener('submit', function(e) {
        let isValid = true;
        
        // Validate name
        const nameInput = document.getElementById('name');
        const nameError = document.getElementById('nameError');
        if (!nameInput.value.trim()) {
          nameError.style.display = 'block';
          nameInput.classList.add('error');
          isValid = false;
        } else {
          nameError.style.display = 'none';
          nameInput.classList.remove('error');
          nameInput.classList.add('success');
        }
        
        // Validate email
        const emailInput = document.getElementById('email');
        const emailError = document.getElementById('emailError');
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(emailInput.value.trim())) {
          emailError.style.display = 'block';
          emailInput.classList.add('error');
          isValid = false;
        } else {
          emailError.style.display = 'none';
          emailInput.classList.remove('error');
          emailInput.classList.add('success');
        }
        
        // Validate message
        const messageInput = document.getElementById('message');
        const messageError = document.getElementById('messageError');
        if (!messageInput.value.trim()) {
          messageError.style.display = 'block';
          messageInput.classList.add('error');
          isValid = false;
        } else {
          messageError.style.display = 'none';
          messageInput.classList.remove('error');
          messageInput.classList.add('success');
        }
        
        // Validate consent
        const consentInput = document.getElementById('dataConsent');
        const consentError = document.getElementById('consentError');
        if (!consentInput.checked) {
          consentError.style.display = 'block';
          isValid = false;
        } else {
          consentError.style.display = 'none';
        }
        
        if (!isValid) {
          e.preventDefault();
        }
      });
    }
    
    // Show success message if form was submitted
    if (window.location.search.includes('contact_posted=true')) {
      const successMessage = document.getElementById('successMessage');
      if (successMessage) {
        successMessage.style.display = 'block';
      }
    }
  });
</script>

{% schema %}
{
  "name": "Custom Contact Form",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Form Heading",
      "default": "Contact Form"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Submit Form"
    },
    {
      "type": "checkbox",
      "id": "show_marketing_opt_in",
      "label": "Show Marketing Opt-in",
      "default": true
    },
    {
      "type": "text",
      "id": "marketing_text",
      "label": "Marketing Checkbox Text",
      "default": "I would like to receive marketing communications about your products and services"
    },
    {
      "type": "text",
      "id": "consent_text",
      "label": "Consent Checkbox Text",
      "default": "I consent to having this website store my submitted information so they can respond to my inquiry. See our privacy policy to learn more about how we protect and manage your submitted data. *"
    },
    {
      "type": "text",
      "id": "privacy_text",
      "label": "Privacy Notice Text",
      "default": "Your personal data will be used to support your experience throughout this website, to manage access to your account, and for other purposes described in our privacy policy."
    }
  ],
  "presets": [
    {
      "name": "Custom Contact Form",
      "category": "Forms"
    }
  ]
}
{% endschema %}