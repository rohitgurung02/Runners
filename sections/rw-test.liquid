{%- assign sid = '#shopify-section-' | append: section.id -%}

{%- style -%}
  {{ sid }} {
    background-color: {{ section.settings.bg_color }};
    padding: 40px 20px;
  }

  {{ sid }} .pc-comparison-table-container {
    max-width: 100%;
    overflow-x: auto;
    margin: 30px auto 0;
    -webkit-overflow-scrolling: touch;
  }

  {{ sid }} .pc-comparison-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 300px;
    border-radius: {{ section.settings.border_radius }}px;
    overflow: hidden;
  }

  {{ sid }} .pc-comparison-table th,
  {{ sid }} .pc-comparison-table td {
    border: 1px solid {{ section.settings.border_color }};
    padding: 15px;
    text-align: center;
    vertical-align: middle;
  }

  {{ sid }} .pc-comparison-table th {
    background-color: {% if section.settings.highlight_header %}{{ section.settings.secondary_accent }}{% else %}transparent{% endif %};
    font-weight: 600;
    color: {{ section.settings.heading_color }};
  }

  {{ sid }} .pc-comparison-table tr:nth-child(even) {
    background-color: {% if section.settings.zebra_striping %}{{ section.settings.secondary_accent | color_modify: 'alpha', 0.5 }}{% else %}transparent{% endif %};
  }

  {{ sid }} .pc-comparison-table .pc-feature-cell {
    font-weight: 500;
    text-align: left;
    {% if section.settings.sticky_first_column %}
    position: sticky;
    left: 0;
    background-color: {{ section.settings.bg_color }};
    z-index: 1;
    {% endif %}
  }

  {{ sid }} .pc-comparison-table .pc-important-feature {
    font-weight: 700;
    color: {{ section.settings.primary_accent }};
  }

  {{ sid }} .pc-comparison-table .pc-featured-product {
    box-shadow: inset 0 0 0 2px {{ section.settings.primary_accent }};
  }

  {{ sid }} .pc-section-heading {
    color: {{ section.settings.heading_color }};
    font-size: {{ section.settings.heading_size }}px;
    text-align: {{ section.settings.heading_alignment }};
    margin-bottom: 20px;
  }

  {{ sid }} .pc-product-image {
    max-width: 100px;
    max-height: 100px;
    margin: 0 auto 10px;
    display: block;
    object-fit: contain;
  }

  {{ sid }} .pc-product-title {
    font-weight: 600;
    margin-bottom: 5px;
    color: {{ section.settings.text_color }};
  }

  {{ sid }} .pc-product-price {
    color: {{ section.settings.primary_accent }};
    font-weight: 700;
  }

  {{ sid }} .pc-features-heading {
    color: {{ section.settings.features_text_color }} !important;
    font-size: {{ section.settings.features_text_size }}px;
    font-weight: {{ section.settings.features_font_weight }};
    text-align: left;
  }

  @media (max-width: 767px) {
    {{ sid }} {
      padding: 20px 10px;
    }

    {{ sid }} .pc-comparison-table {
      min-width: 100%;
    }

    {{ sid }} .pc-comparison-table th,
    {{ sid }} .pc-comparison-table td {
      padding: 10px 8px;
      font-size: 14px;
    }

    {{ sid }} .pc-section-heading {
      font-size: {{ section.settings.heading_size | times: 0.7 }}px;
      margin-bottom: 15px;
    }

    {{ sid }} .pc-product-image {
      max-width: 60px;
      max-height: 60px;
    }

    {{ sid }} .pc-product-title {
      font-size: 14px;
    }

    {{ sid }} .pc-product-price {
      font-size: 14px;
    }

    {{ sid }} .pc-comparison-table-container {
      margin: 20px auto 0;
    }
  }

  @media (max-width: 480px) {
    {{ sid }} .pc-comparison-table th,
    {{ sid }} .pc-comparison-table td {
      padding: 8px 5px;
      font-size: 12px;
    }

    {{ sid }} .pc-product-image {
      max-width: 50px;
      max-height: 50px;
    }

    {{ sid }} .pc-product-title {
      font-size: 12px;
    }

    {{ sid }} .pc-product-price {
      font-size: 12px;
    }

    {{ sid }} .pc-features-heading {
      font-size: {{ section.settings.features_text_size | times: 0.8 }}px;
    }
  }
{%- endstyle -%}

<div class="page-width">
  {%- if section.settings.heading != blank -%}
    <h2 class="pc-section-heading">{{ section.settings.heading }}</h2>
  {%- endif -%}

  <div class="pc-comparison-table-container">
    <table class="pc-comparison-table">
      <thead>
        <tr>
          <th style="width: 200px;" class="pc-features-heading">
            {{ section.settings.features_heading_text }}
          </th>
          {%- for block in section.blocks -%}
            {%- if block.type == 'product' and block.settings.product != blank -%}
              {%- assign product = all_products[block.settings.product] -%}
              <th
                style="width: {{ section.settings.column_width }}px;"
                {% if block.settings.featured_product %}
                  class="pc-featured-product"
                {% endif %}
              >
                {%- if product.featured_image -%}
                  {{
                    product.featured_image
                    | image_url: width: 200, height: 200
                    | image_tag: loading: 'lazy', class: 'pc-product-image', alt: product.title
                    | escape
                  }}
                {%- endif -%}
                <div class="pc-product-title">{{ product.title }}</div>
                <div class="pc-product-price">{{ product.price | money }}</div>
              </th>
            {%- endif -%}
          {%- endfor -%}
        </tr>
      </thead>
      <tbody>
        {%- for block in section.blocks -%}
          {%- if block.type == 'feature' -%}
            {%- assign feature_values = block.settings.feature_values | split: ',' -%}
            <tr>
              <td class="pc-feature-cell {% if block.settings.is_important %}pc-important-feature{% endif %}">
                {{ block.settings.feature_name }}
              </td>
              {%- for value in feature_values -%}
                <td>{{ value | strip }}</td>
              {%- endfor -%}
            </tr>
          {%- endif -%}
        {%- endfor -%}
      </tbody>
    </table>
  </div>
</div>

{% schema %}
{
  "name": "PWC - Comparison Table #1",
  "class": "pc-comparison-section",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "Compare Products"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Heading Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "Heading Font Size",
      "min": 16,
      "max": 60,
      "step": 1,
      "unit": "px",
      "default": 32
    },
    {
      "type": "header",
      "content": "Features Column Settings"
    },
    {
      "type": "text",
      "id": "features_heading_text",
      "label": "Features Column Heading",
      "default": "Features"
    },
    {
      "type": "range",
      "id": "features_text_size",
      "label": "Features Text Size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "header",
      "content": "Style Settings"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Text Color",
      "default": "#333333"
    },
     {
      "type": "color",
      "id": "features_text_color",
      "label": "Button Text Color",
      "default": "#000"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border Color",
      "default": "#e1e1e1"
    },
    {
      "type": "color",
      "id": "primary_accent",
      "label": "Primary Accent Color",
      "default": "#2563eb"
    },
    {
      "type": "color",
      "id": "secondary_accent",
      "label": "Secondary Accent Color",
      "default": "#f8fafc"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Border Radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 8
    },
    {
      "type": "header",
      "content": "Table Settings"
    },
    {
      "type": "range",
      "id": "column_width",
      "label": "Column Width (Desktop)",
      "min": 100,
      "max": 400,
      "step": 10,
      "unit": "px",
      "default": 200
    },
    {
      "type": "checkbox",
      "id": "sticky_first_column",
      "label": "Sticky First Column",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "highlight_header",
      "label": "Highlight Header Row",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "zebra_striping",
      "label": "Zebra Striping",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "checkbox",
          "id": "featured_product",
          "label": "Featured Product",
          "default": false
        }
      ]
    },
    {
      "type": "feature",
      "name": "Feature",
      "settings": [
        {
          "type": "text",
          "id": "feature_name",
          "label": "Feature Name",
          "default": "Feature"
        },
        {
          "type": "header",
          "content": "Feature Values",
          "info": "Add values for each product in the same order as products appear"
        },
        {
          "type": "textarea",
          "id": "feature_values",
          "label": "Values (comma separated)",
          "default": "Yes, No, Maybe",
          "info": "Separate values with commas. One value per product."
        },
        {
          "type": "checkbox",
          "id": "is_important",
          "label": "Highlight this feature",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "PWC - Comparison Table #1",
      "category": "Custom"
    }
  ]
}
{% endschema %}