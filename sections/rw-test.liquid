{%- assign sec_id = '#shopify-section-' | append: section.id -%}
{%- assign parts = sec_id | split: '_' -%}
{%- assign last_lower = parts | last -%}
{%- assign last_part = last_lower | downcase -%}

<style>
  {{ sec_id }} {
    background: #111;
    margin: 0;
    padding: 1rem;
    min-height: 100svh;
    display: grid;
    place-content: center;
    grid-template-rows: 1fr auto;
  }

  {{ sec_id }} * {
    box-sizing: border-box;
  }

  {{ sec_id }} .pc-flip-container-{{ last_part }} {
    align-content: center;
    font-family: {{ section.settings.font_family }}, monospace;
  }

  {{ sec_id }} .pc-flip-text-{{ last_part }} {
    --clr-1: {{ section.settings.primary_color }};
    --clr-2: {{ section.settings.secondary_color }};
    --clr-3: {{ section.settings.accent_color }};
    --translate-distance: 1lh;
    --duration: {{ section.settings.animation_duration }}s;
    --timing-function: cubic-bezier(0.66, 0, 0.34, 1);

    overflow-y: hidden;
    width: min(100%, 1200px);
    margin-inline: auto;
    display: grid;
    grid-auto-columns: 1fr;
    grid-auto-flow: column;
    gap: 0;
    font-size: clamp(1rem, 4.5vw + 0.05rem, 5rem);
    font-weight: 700;
    color: var(--clr-1);
    line-height: 1;
  }

  {{ sec_id }} .pc-flip-text-{{ last_part }}:nth-child(2) {
    font-size: clamp(1rem, 3.5vw + 0.05rem, 3rem);
    font-weight: 300;
    color: var(--clr-2);
    --delay-factor: 300ms;
  }

  {{ sec_id }} .pc-flip-text-{{ last_part }} > * {
    --delay: calc(var(--i) * 100ms + var(--delay-factor, 0ms));
    --translate: calc(var(--translate-distance) * 2);

    display: grid;
    place-content: center;
  }

  @media not (prefers-reduced-motion) {
    {{ sec_id }} .pc-flip-text-{{ last_part }} > * {
      animation-name: pc-flip-transform-{{ last_part }}, pc-flip-translate-{{ last_part }};
      animation-duration: var(--duration);
      animation-timing-function: var(--timing-function);
      animation-iteration-count: infinite;
      animation-delay: var(--delay);
    }
  }

  {{ sec_id }} .pc-flip-footer-{{ last_part }} {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    font-size: 0.7rem;
    color: #aaa;
  }

  {{ sec_id }} .pc-flip-footer-{{ last_part }} > a {
    color: {{ section.settings.link_color }};
    text-decoration: none;
    transition: color 150ms ease-in-out;
  }

  {{ sec_id }} .pc-flip-footer-{{ last_part }} > a:hover {
    color: {{ section.settings.link_hover_color }};
  }

  @keyframes pc-flip-transform-{{ last_part }} {
    25% {
      /*scale: 1 -1;*/
    }
    50%,
    100% {
      transform: translateY(calc(var(--translate) * -1));
    }
  }

  @keyframes pc-flip-translate-{{ last_part }} {
    24.999999% {
      opacity: 1;
      translate: 0 0;
    }
    25% {
      opacity: 0;
    }
    25.000001%,
    100% {
      opacity: 1;
      translate: 0 calc(var(--translate) * 1);
    }
  }

  {% for i in (1..22) %}
    {{ sec_id }} .pc-flip-text-{{ last_part }} > *:nth-child({{ i }}) {
      --i: {{ i }};
    }
  {% endfor %}
</style>

<section class="pc-flip-container-{{ last_part }}">
  <div class="pc-flip-text-{{ last_part }}">
    {%- assign first_text = section.settings.first_text | default: "1000 FOLLOWERS" -%}
    {%- for char in first_text -%}
      <span>{{ char }}</span>
    {%- endfor -%}
  </div>
  
  <div class="pc-flip-text-{{ last_part }}">
    {%- assign second_text = section.settings.second_text | default: "♥♥♥♥ THANKYOU ♥♥♥♥" -%}
    {%- for char in second_text -%}
      <span>{{ char }}</span>
    {%- endfor -%}
  </div>

  {%- if section.settings.show_footer -%}
    <footer class="pc-flip-footer-{{ last_part }}">
      {{ section.settings.footer_label }}
      {%- for block in section.blocks -%}
        <a href="{{ block.settings.link_url }}" target="_blank" title="{{ block.settings.link_title }}">
          {{ block.settings.link_text }}
        </a>
      {%- endfor -%}
    </footer>
  {%- endif -%}
</section>

{% schema %}
{
  "name": "Flip Text Animation #1",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "first_text",
      "label": "First Line Text",
      "default": "1000 FOLLOWERS"
    },
    {
      "type": "text",
      "id": "second_text",
      "label": "Second Line Text",
      "default": "♥♥♥♥ THANKYOU ♥♥♥♥"
    },
    {
      "type": "header",
      "content": "Footer Settings"
    },
    {
      "type": "checkbox",
      "id": "show_footer",
      "label": "Show Footer",
      "default": true
    },
    {
      "type": "text",
      "id": "footer_label",
      "label": "Footer Label",
      "default": "Previous celebratory pens:"
    },
    {
      "type": "header",
      "content": "Style Settings"
    },
    {
      "type": "select",
      "id": "font_family",
      "label": "Font Family",
      "options": [
        {
          "value": "system-ui",
          "label": "System UI"
        },
        {
          "value": "Arial",
          "label": "Arial"
        },
        {
          "value": "Courier New",
          "label": "Courier New"
        },
        {
          "value": "Georgia",
          "label": "Georgia"
        },
        {
          "value": "Times New Roman",
          "label": "Times New Roman"
        }
      ],
      "default": "Courier New"
    },
    {
      "type": "color",
      "id": "primary_color",
      "label": "Primary Color",
      "default": "#1e90ff"
    },
    {
      "type": "color",
      "id": "secondary_color",
      "label": "Secondary Color",
      "default": "#ff69b4"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color",
      "default": "#5ea500"
    },
    {
      "type": "color",
      "id": "link_color",
      "label": "Link Color",
      "default": "#1e90ff"
    },
    {
      "type": "color",
      "id": "link_hover_color",
      "label": "Link Hover Color",
      "default": "#ff69b4"
    },
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "range",
      "id": "animation_duration",
      "label": "Animation Duration",
      "min": 1,
      "max": 10,
      "step": 0.5,
      "unit": "s",
      "default": 3
    }
  ],
  "blocks": [
    {
      "name": "Footer Link",
      "type": "link",
      "settings": [
        {
          "type": "text",
          "id": "link_text",
          "label": "Link Text"
        },
        {
          "type": "url",
          "id": "link_url",
          "label": "Link URL"
        },
        {
          "type": "text",
          "id": "link_title",
          "label": "Link Title"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Flip Text Animation #1",
      "category": "Text",
      "blocks": [
        {
          "type": "link",
          "settings": {
            "link_text": "500",
            "link_title": "See my pen celebrating 500 followers"
          }
        },
        {
          "type": "link",
          "settings": {
            "link_text": "404",
            "link_title": "See my pen celebrating 404 followers"
          }
        },
        {
          "type": "link",
          "settings": {
            "link_text": "200",
            "link_title": "See my pen celebrating 200 followers"
          }
        },
        {
          "type": "link",
          "settings": {
            "link_text": "100",
            "link_title": "See my pen celebrating 100 followers"
          }
        }
      ]
    }
  ]
}
{% endschema %}