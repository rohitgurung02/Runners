{% assign sec_id = '#shopify-section-' | append: section.id %}
{%- assign parts = sec_id | split: '_' -%}
{%- assign last_lower = parts | last -%}
{%- assign last_part = last_lower | downcase -%}

<pc-space-facts-slider-{{ last_part }} class="pc-slider-{{ last_part }}">
  <div class="pc-slider-wrapper-{{ last_part }}">
    {% for block in section.blocks %}
      <div class="pc-slider-item-{{ last_part }}">
        {% if block.settings.image != blank %}
          {% assign image_class = 'pc-slider-image-' | append: last_part %}
          {{ block.settings.image
            | image_url: width: block.settings.image.width
            | image_tag: loading: 'lazy', class: image_class, alt: block.settings.image.alt
          }}
        {% else %}
          {{ 'product-1' | placeholder_svg_tag }}
        {% endif %}
        <h2 class="pc-slider-title-{{ last_part }}">{{ block.settings.title }}</h2>
        <p class="pc-slider-text-{{ last_part }}">{{ block.settings.text }}</p>
      </div>
    {% endfor %}
    <button class="pc-slider-prev-{{ last_part }}" aria-label="Previous Slide">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    </button>
    <button class="pc-slider-next-{{ last_part }}" aria-label="Next Slide">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </button>
  </div>
</pc-space-facts-slider-{{ last_part }}>

<style>
{{ sec_id }} .pc-slider-{{ last_part }} {
  position: relative;
  width: 100%;
  background-color: {{ section.settings.background_color }};
  padding-top: {{ section.settings.desktop_padding_top }}px;
  padding-bottom: {{ section.settings.desktop_padding_bottom }}px;
  margin-top: {{ section.settings.desktop_margin_top }}px;
  margin-bottom: {{ section.settings.desktop_margin_bottom }}px;
  {% if section.settings.enable_shadow %}
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  {% endif %}
}

{{ sec_id }} .pc-slider-wrapper-{{ last_part }} {
  position: relative;
  max-width: {{ section.settings.desktop_max_width }}px;
  margin: 0 auto;
  height: {{ section.settings.desktop_height }}px;
  overflow: hidden;
}

{{ sec_id }} .pc-slider-item-{{ last_part }} {
  position: absolute;
  width: {{ section.settings.card_width }}px;
  height: {{ section.settings.card_height }}px;
  background-color: {{ section.settings.card_background_color }};
  border-radius: {{ section.settings.border_radius }}px;
  padding: 20px;
  text-align: justify;
  transition: transform 0.5s, opacity 0.5s, filter 0.5s;
  left: calc(50% - {{ section.settings.card_width | divided_by: 2 }}px);
  top: 0;
}

{{ sec_id }} .pc-slider-title-{{ last_part }} {
  font-size: {{ section.settings.desktop_font_size }}px;
  color: {{ section.settings.text_color }};
  font-weight: {{ section.settings.font_weight }};
  margin: 0 0 10px;
}

{{ sec_id }} .pc-slider-text-{{ last_part }} {
  font-size: {{ section.settings.desktop_font_size | minus: 4 }}px;
  color: {{ section.settings.text_color }};
}

{{ sec_id }} .pc-slider-image-{{ last_part }} {
  width: 100%;
  height: auto;
  border-radius: {{ section.settings.border_radius }}px;
  margin-bottom: 10px;
}

{{ sec_id }} .pc-slider-prev-{{ last_part }}, {{ sec_id }} .pc-slider-next-{{ last_part }} {
  position: absolute;
  top: 40%;
  background: none;
  border: none;
  color: {{ section.settings.arrow_color }};
  font-size: {{ section.settings.desktop_font_size }}px;
  opacity: 0.5;
  transition: opacity 0.5s;
  cursor: pointer;
}

{{ sec_id }} .pc-slider-prev-{{ last_part }} {
  left: {{ section.settings.arrow_spacing }}px;
}

{{ sec_id }} .pc-slider-next-{{ last_part }} {
  right: {{ section.settings.arrow_spacing }}px;
}

{{ sec_id }} .pc-slider-prev-{{ last_part }}:hover, {{ sec_id }} .pc-slider-next-{{ last_part }}:hover {
  opacity: 1;
}

/* Mobile Styles */
@media screen and (max-width: 768px) {
  {{ sec_id }} .pc-slider-{{ last_part }} {
    padding-top: {{ section.settings.mobile_padding_top }}px;
    padding-bottom: {{ section.settings.mobile_padding_bottom }}px;
    margin-top: {{ section.settings.mobile_margin_top }}px;
    margin-bottom: {{ section.settings.mobile_margin_bottom }}px;
  }

  {{ sec_id }} .pc-slider-wrapper-{{ last_part }} {
    max-width: {{ section.settings.mobile_max_width }}px;
    height: {{ section.settings.mobile_height }}px;
  }

  {{ sec_id }} .pc-slider-item-{{ last_part }} {
    width: {{ section.settings.mobile_card_width }}px;
    height: {{ section.settings.mobile_card_height }}px;
  }

  {{ sec_id }} .pc-slider-title-{{ last_part }} {
    font-size: {{ section.settings.mobile_font_size }}px;
  }

  {{ sec_id }} .pc-slider-text-{{ last_part }} {
    font-size: {{ section.settings.mobile_font_size | minus: 4 }}px;
  }
}
</style>

<script>
class PCSpaceFactsSlider extends HTMLElement {
  constructor() {
    super();
    this.items = this.querySelectorAll('.pc-slider-item-{{ last_part }}');
    this.prevButton = this.querySelector('.pc-slider-prev-{{ last_part }}');
    this.nextButton = this.querySelector('.pc-slider-next-{{ last_part }}');
    this.active = {{ section.settings.initial_slide | default: 3 }};
    this.init();
  }

  init() {
    this.loadShow();
    this.nextButton.addEventListener('click', () => {
      this.active = this.active + 1 < this.items.length ? this.active + 1 : this.active;
      this.loadShow();
    });
    this.prevButton.addEventListener('click', () => {
      this.active = this.active - 1 >= 0 ? this.active - 1 : this.active;
      this.loadShow();
    });
  }

  loadShow() {
    this.items.forEach((item, index) => {
      item.style.transform = 'none';
      item.style.zIndex = 0;
      item.style.filter = 'none';
      item.style.opacity = 0;

      if (index === this.active) {
        item.style.transform = 'none';
        item.style.zIndex = 1;
        item.style.filter = 'none';
        item.style.opacity = 1;
      } else if (index > this.active) {
        let stt = index - this.active;
        item.style.transform = `translateX(${120 * stt}px) scale(${1 - 0.2 * stt}) perspective(16px) rotateY(-1deg)`;
        item.style.zIndex = -stt;
        item.style.filter = 'blur(5px)';
        item.style.opacity = stt > 2 ? 0 : 0.6;
      } else {
        let stt = this.active - index;
        item.style.transform = `translateX(${-120 * stt}px) scale(${1 - 0.2 * stt}) perspective(16px) rotateY(1deg)`;
        item.style.zIndex = -stt;
        item.style.filter = 'blur(5px)';
        item.style.opacity = stt > 2 ? 0 : 0.6;
      }
    });
  }
}

customElements.define('pc-space-facts-slider-{{ last_part }}', PCSpaceFactsSlider);
</script>

{% schema %}
{
  "name": "PWC - Facts Slider #1",
  "settings": [
    {
      "type": "header",
      "content": "General Settings"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "card_background_color",
      "label": "Card Background Color",
      "default": "#ffffff"
    },
    {
      "type": "checkbox",
      "id": "enable_shadow",
      "label": "Enable Shadow",
      "default": false
    },
    {
      "type": "range",
      "id": "initial_slide",
      "label": "Initial Slide",
      "min": 0,
      "max": 9,
      "step": 1,
      "default": 3
    },
    {
      "type": "header",
      "content": "Typography Settings"
    },
    {
      "type": "range",
      "id": "desktop_font_size",
      "label": "Font Size (Desktop)",
      "min": 12,
      "max": 48,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "mobile_font_size",
      "label": "Font Size (Mobile)",
      "min": 12,
      "max": 36,
      "step": 2,
      "unit": "px",
      "default": 20
    },
    {
      "type": "select",
      "id": "font_weight",
      "label": "Font Weight",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "700", "label": "Bold" }
      ],
      "default": "400"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Desktop Settings"
    },
    {
      "type": "range",
      "id": "desktop_padding_top",
      "label": "Top Padding (Desktop)",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 100
    },
    {
      "type": "range",
      "id": "desktop_padding_bottom",
      "label": "Bottom Padding (Desktop)",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "desktop_margin_top",
      "label": "Top Margin (Desktop)",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "desktop_margin_bottom",
      "label": "Bottom Margin (Desktop)",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "desktop_max_width",
      "label": "Max Width (Desktop)",
      "min": 600,
      "max": 1600,
      "step": 50,
      "unit": "px",
      "default": 1200
    },
    {
      "type": "range",
      "id": "desktop_height",
      "label": "Slider Height (Desktop)",
      "min": 200,
      "max": 600,
      "step": 10,
      "unit": "px",
      "default": 370
    },
    {
      "type": "range",
      "id": "card_width",
      "label": "Card Width (Desktop)",
      "min": 100,
      "max": 400,
      "step": 10,
      "unit": "px",
      "default": 200
    },
    {
      "type": "range",
      "id": "card_height",
      "label": "Card Height (Desktop)",
      "min": 100,
      "max": 400,
      "step": 10,
      "unit": "px",
      "default": 320
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Border Radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 10
    },
    {
      "type": "header",
      "content": "Mobile Settings"
    },
    {
      "type": "range",
      "id": "mobile_padding_top",
      "label": "Top Padding (Mobile)",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 50
    },
    {
      "type": "range",
      "id": "mobile_padding_bottom",
      "label": "Bottom Padding (Mobile)",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "mobile_margin_top",
      "label": "Top Margin (Mobile)",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "mobile_margin_bottom",
      "label": "Bottom Margin (Mobile)",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "mobile_max_width",
      "label": "Max Width (Mobile)",
      "min": 300,
      "max": 800,
      "step": 10,
      "unit": "px",
      "default": 600
    },
    {
      "type": "range",
      "id": "mobile_height",
      "label": "Slider Height (Mobile)",
      "min": 200,
      "max": 600,
      "step": 10,
      "unit": "px",
      "default": 300
    },
    {
      "type": "range",
      "id": "mobile_card_width",
      "label": "Card Width (Mobile)",
      "min": 100,
      "max": 300,
      "step": 10,
      "unit": "px",
      "default": 180
    },
    {
      "type": "range",
      "id": "mobile_card_height",
      "label": "Card Height (Mobile)",
      "min": 100,
      "max": 300,
      "step": 10,
      "unit": "px",
      "default": 280
    },
    {
      "type": "header",
      "content": "Navigation Settings"
    },
    {
      "type": "color",
      "id": "arrow_color",
      "label": "Arrow Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "arrow_spacing",
      "label": "Arrow Spacing from Edges",
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 50
    }
  ],
  "blocks": [
    {
      "type": "fact",
      "name": "Space Fact",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Space Fact"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Description",
          "default": "Enter a space fact description here."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "PWC - Facts Slider #1",
      "category": "Custom",
      "blocks": [
        {
          "type": "fact",
          "settings": {
            "title": "Space Fact 1",
            "text": "Jupiter protects Earth - its gravity acts like a cosmic shield, deflecting comets and asteroids."
          }
        },
        {
          "type": "fact",
          "settings": {
            "title": "Space Fact 2",
            "text": "Stars 'beat' like hearts - they pulsate, expanding and contracting as they burn fuel."
          }
        },
        {
          "type": "fact",
          "settings": {
            "title": "Space Fact 3",
            "text": "Galaxies can 'eat' each other - the Milky Way is currently consuming the Sagittarius Dwarf Galaxy."
          }
        },
        {
          "type": "fact",
          "settings": {
            "title": "Space Fact 4",
            "text": "Space smells like seared steak - astronauts describe a metallic/grilled odor after spacewalks."
          }
        },
        {
          "type": "fact",
          "settings": {
            "title": "Space Fact 5",
            "text": "Astronauts grow taller in space - spines stretch up to 2 inches without gravity's compression."
          }
        },
        {
          "type": "fact",
          "settings": {
            "title": "Space Fact 6",
            "text": "Space has its own 'internet' - neutron stars beam signals like cosmic radio towers."
          }
        },
        {
          "type": "fact",
          "settings": {
            "title": "Space Fact 7",
            "text": "There's an alcohol cloud in space - in Aquila, containing enough ethanol for 400 septillion drinks."
          }
        },
        {
          "type": "fact",
          "settings": {
            "title": "Space Fact 8",
            "text": "Your body contains stardust - atoms of heavy elements like calcium were forged in supernovae."
          }
        },
        {
          "type": "fact",
          "settings": {
            "title": "Space Fact 9",
            "text": "Black holes can 'sing' - they create sound waves when consuming matter, but humans can't hear them."
          }
        }
      ]
    }
  ]
}
{% endschema %}