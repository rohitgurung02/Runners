{%- assign sec_id = '#shopify-section-' | append: section.id -%}
{%- assign parts = sec_id | split: '_' -%}
{%- assign last_lower = parts | last -%}
{%- assign last_part = last_lower | downcase -%}

<style>
  {{ sec_id }} {
    display: grid;
    place-items: start;
    padding-block: min(20vh, 3rem);
  }

  {{ sec_id }} .pc-testimonial-container-{{ last_part }} {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    width: calc(min(90rem, 85%));
    margin: 0 auto;
  }

  {{ sec_id }} .pc-testimonial-title-{{ last_part }} {
    grid-column: span 12;
    text-transform: capitalize;
    font-size: 2.4rem;
    margin-bottom: 2rem;
    font-weight: 700;
    color: {{ section.settings.title_color }};
  }

  {{ sec_id }} .pc-testimonial-cards-{{ last_part }} {
    grid-column: span 12;
    display: grid;
    gap: 2rem;
  }

  {{ sec_id }} .pc-testimonial-card-{{ last_part }} {
    cursor: pointer;
    padding: 2em;
    border-radius: 1rem;
    display: grid;
    grid-template-columns: auto 1fr;
    column-gap: 2.188rem;
    align-items: center;
    transition: 0.3s;
    position: relative;
    border: 0.094rem solid transparent;
    background: {{ section.settings.card_bg_color }};
  }

  {{ sec_id }} .pc-testimonial-card-{{ last_part }} img {
    display: block;
    width: 3.35rem;
    height: 3.35rem;
    border-radius: 50%;
    filter: grayscale(1);
    transition: 0.5s;
  }

  {{ sec_id }} .pc-testimonial-card-info-{{ last_part }} h3 {
    text-transform: capitalize;
    font-size: 1.025rem;
    color: {{ section.settings.name_color }};
  }

  {{ sec_id }} .pc-testimonial-card-info-{{ last_part }} p {
    text-transform: capitalize;
    color: {{ section.settings.role_color }};
    font-size: 0.9rem;
  }

  {{ sec_id }} .pc-testimonial-card-{{ last_part }}.pc-active,
  {{ sec_id }} .pc-testimonial-card-{{ last_part }}:hover {
    background: {{ section.settings.card_active_bg }};
    border: 0.094rem solid {{ section.settings.card_active_border }};
  }

  {{ sec_id }} .pc-testimonial-card-{{ last_part }}.pc-active img,
  {{ sec_id }} .pc-testimonial-card-{{ last_part }}:hover img {
    filter: grayscale(0);
  }

  {{ sec_id }} .pc-testimonial-gradient-{{ last_part }} {
    background-image: linear-gradient(
      to right,
      #4755690a,
      #9d0cb28a,
      #4343c899,
      #4755690a
    );
    width: 50%;
    height: 0.094rem;
    position: absolute;
    content: "";
    bottom: -0.063rem;
    left: 50%;
    transform: translateX(-50%);
    box-shadow: 0px 0.125rem 0.75rem #4343c84d;
  }

  {{ sec_id }} .pc-testimonial-content-{{ last_part }} {
    grid-column: span 12;
    position: relative;
    width: 100%;
    overflow: inherit;
    margin-top: 2rem;
    min-height: 200px;
  }

  {{ sec_id }} .pc-testimonial-content-box-{{ last_part }} {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: start;
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
}

  {{ sec_id }} .pc-testimonial-content-box-{{ last_part }}.pc-active {
  opacity: 1;
  pointer-events: auto;
}

  {{ sec_id }} .pc-testimonial-text-{{ last_part }} {
    padding-bottom: 2rem;
  }

  {{ sec_id }} .pc-testimonial-text-{{ last_part }} h2 {
    color: {{ section.settings.content_title_color }};
    font-size: {{ section.settings.content_title_size }}px;
  }

  {{ sec_id }} .pc-testimonial-text-{{ last_part }} p {
    margin-top: 1.25rem;
    color: {{ section.settings.content_text_color }};
    font-size: {{ section.settings.content_text_size }}px;
  }

  {{ sec_id }} .pc-testimonial-rating-{{ last_part }} {
    display: inline-block;
    margin-top: 0.625rem;
  }

  {{ sec_id }} .pc-testimonial-rating-{{ last_part }} svg {
    width: 1.25rem;
    color: {{ section.settings.rating_color }};
  }

  @media screen and (min-width: 61.25rem) {
    {{ sec_id }} {
      place-items: center;
    }
    
    {{ sec_id }} .pc-testimonial-container-{{ last_part }} {
      column-gap: 5rem;
    }
    
    {{ sec_id }} .pc-testimonial-title-{{ last_part }} {
      font-size: 4rem;
      margin-bottom: 4rem;
    }
    
    {{ sec_id }} .pc-testimonial-cards-{{ last_part }} {
      grid-column: span 5;
    }
    
    {{ sec_id }} .pc-testimonial-content-{{ last_part }} {
      grid-column: span 7;
      margin-top: 0;
      height: auto;
    }
    
    {{ sec_id }} .pc-testimonial-content-box-{{ last_part }} {
      align-items: center;
    }
    
    {{ sec_id }} .pc-testimonial-text-{{ last_part }} {
      padding-bottom: 0;
    }
  }

  {% if section.settings.enable_shadow %}
    {{ sec_id }} .pc-testimonial-card-{{ last_part }}.pc-active,
    {{ sec_id }} .pc-testimonial-card-{{ last_part }}:hover {
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
  {% endif %}
</style>

<pc-testimonial-section-{{ last_part }} class="pc-testimonial-container-{{ last_part }}">
  <h1 class="pc-testimonial-title-{{ last_part }}">{{ section.settings.title }}</h1>
  
  <div class="pc-testimonial-cards-{{ last_part }}">
    {% for block in section.blocks %}
      <div class="pc-testimonial-card-{{ last_part }} {% if forloop.first %}pc-active{% endif %}" 
           data-id="content{{ forloop.index }}"
           onmouseenter="handleCardHover('content{{ forloop.index }}', true)"
           onmouseleave="handleCardHover('content{{ forloop.index }}', false)">
        {%- if block.settings.image != blank -%}
          {% assign image_class = 'pc-testimonial-image-' | append: last_part %}
          {{ 
            block.settings.image 
            | image_url: width: 400 
            | image_tag: 
                loading: 'lazy', 
                class: image_class,
                alt: block.settings.name 
          }}
        {%- else -%}
          {{ 'product-1' | placeholder_svg_tag }}
        {%- endif -%}
        <div class="pc-testimonial-card-info-{{ last_part }}">
          <h3>{{ block.settings.name }}</h3>
          <p>{{ block.settings.role }}</p>
        </div>
        <div class="pc-testimonial-gradient-{{ last_part }}"></div>
      </div>
    {% endfor %}
  </div>
  
  <div class="pc-testimonial-content-{{ last_part }}">
    {% for block in section.blocks %}
      <div class="pc-testimonial-content-box-{{ last_part }} {% if forloop.first %}pc-active{% endif %}" 
           id="content{{ forloop.index }}">
        <div class="pc-testimonial-text-{{ last_part }}">
          <h2>{{ block.settings.testimonial_title }}</h2>
          <div class="pc-testimonial-rating-{{ last_part }}">
            {% for i in (1..5) %}
              {% if i <= block.settings.rating %}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd"/>
                </svg>
              {% endif %}
            {% endfor %}
          </div>
          <p>{{ block.settings.testimonial_text_1 }}</p>
          <p>{{ block.settings.testimonial_text_2 }}</p>
        </div>
      </div>
    {% endfor %}
  </div>
</pc-testimonial-section-{{ last_part }}>

<script>
  class PcTestimonialSection extends HTMLElement {
    constructor() {
      super();
      this.cards = this.querySelectorAll('.pc-testimonial-card-{{ last_part }}');
      this.contentBoxes = this.querySelectorAll('.pc-testimonial-content-box-{{ last_part }}');
      this.activeIndex = 0;
      this.hoverTimeout = null;
      
      // Initialize with first testimonial active
      this.activateTestimonial(0);
      
      // Add event listeners to all cards
      this.cards.forEach((card, index) => {
        card.addEventListener('mouseenter', () => {
          clearTimeout(this.hoverTimeout);
          this.activateTestimonial(index);
        });
        
        // Optional: Add click event as fallback for mobile/touch devices
        card.addEventListener('click', () => {
          this.activateTestimonial(index);
        });
      });
    }
    
    activateTestimonial(index) {
      // Remove active classes from all cards and content boxes
      this.cards.forEach(card => card.classList.remove('pc-active'));
      this.contentBoxes.forEach(box => box.classList.remove('pc-active', 'pc-hover'));
      
      // Add active class to selected card and corresponding content box
      this.cards[index].classList.add('pc-active');
      this.contentBoxes[index].classList.add('pc-active');
      this.activeIndex = index;
    }
  }

  customElements.define('pc-testimonial-section-{{ last_part }}', PcTestimonialSection);
</script>

{% schema %}
{
  "name": "PWC - Testimonials #6",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Testimonials"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#26273e"
    },
    {
      "type": "color",
      "id": "card_bg_color",
      "label": "Card Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "card_active_bg",
      "label": "Active Card Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "card_active_border",
      "label": "Active Card Border",
      "default": "#0f172a14"
    },
    {
      "type": "color",
      "id": "name_color",
      "label": "Name Color",
      "default": "#26273e"
    },
    {
      "type": "color",
      "id": "role_color",
      "label": "Role Color",
      "default": "#767676"
    },
    {
      "type": "color",
      "id": "content_title_color",
      "label": "Content Title Color",
      "default": "#26273e"
    },
    {
      "type": "range",
      "id": "content_title_size",
      "label": "Content Title Size (Desktop)",
      "min": 12,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "color",
      "id": "content_text_color",
      "label": "Content Text Color",
      "default": "#26273e"
    },
    {
      "type": "range",
      "id": "content_text_size",
      "label": "Content Text Size (Desktop)",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "color",
      "id": "rating_color",
      "label": "Rating Color",
      "default": "#eca633"
    },
    {
      "type": "checkbox",
      "id": "enable_shadow",
      "label": "Enable Shadow on Active Card",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Name",
          "default": "John Doe"
        },
        {
          "type": "text",
          "id": "role",
          "label": "Role",
          "default": "Sales Manager, Company"
        },
        {
          "type": "range",
          "id": "rating",
          "label": "Rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        },
        {
          "type": "text",
          "id": "testimonial_title",
          "label": "Testimonial Title",
          "default": "Great collaboration"
        },
        {
          "type": "textarea",
          "id": "testimonial_text_1",
          "label": "Testimonial Text 1",
          "default": "Lorem ipsum dolor sit amet consectetur adipisicing elit. Natus iure possimus harum quisquam praesentium ipsum accusantium, facilis omnis, blanditiis quas soluta nihil incidunt laboriosam dicta maiores, modi quaerat consectetur officia accusamus libero aut molestiae fuga eveniet quidem?"
        },
        {
          "type": "textarea",
          "id": "testimonial_text_2",
          "label": "Testimonial Text 2",
          "default": "Lorem ipsum dolor sit amet consectetur adipisicing elit. Consequatur eius odit at aliquid, reprehenderit repellendus quo vero nam cumque incidunt iusto optio molestias facilis eum corrupti dolorum rem nemo."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "PWC - Testimonials #6",
      "category": "Custom"
    }
  ]
}
{% endschema %}