{%- assign sec_id = '#shopify-section-' | append: section.id -%}
{%- assign parts = sec_id | split: '_' -%}
{%- assign last_lower = parts | last -%}
{%- assign last_part = last_lower | downcase -%}

<style>
  {{ sec_id }} {
    display: flex;
    overflow: hidden;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    background-color: {{ section.settings.body_color }};
    padding: {{ section.settings.desktop_padding }}px;
  }

  {{ sec_id }} .pc-orbit-container-{{ last_part }} {
    --size: {{ section.settings.image_size }}px;
    --offset: {{ section.settings.orbit_offset }}px;
    --duration: {{ section.settings.animation_duration }}s;
    position: relative;
    aspect-ratio: 1 / 1;
    pointer-events: none;
    display: inline-grid;
    border-radius: 9999px;
    width: calc(var(--size) * 3);
    border: {{ section.settings.border_width }}px solid {{ section.settings.primary_color }};
    transition: box-shadow 0.3s ease-in-out;
    animation: pc-spin-out-{{ last_part }} var(--duration) linear infinite;
  }

  {{ sec_id }} .pc-orbit-item-{{ last_part }} {
    z-index: 1;
    display: flex;
    grid-area: 1 / 1;
    width: var(--size);
    aspect-ratio: 1 / 1;
    pointer-events: auto;
    border-radius: 9999px;
    animation: pc-spin-in-{{ last_part }} var(--duration) linear infinite reverse;
    offset: circle(
        calc(var(--size) / (2 * sin(0.5turn / sibling-count())) + var(--offset))
      calc(100% * sibling-index() / sibling-count()) 0deg;
  }

  {{ sec_id }} .pc-orbit-item-{{ last_part }} img {
    width: inherit;
    height: inherit;
    pointer-events: auto;
    border-radius: 9999px;
    border: {{ section.settings.image_border_width }}px solid {{ section.settings.primary_color }};
    transition: box-shadow 0.3s ease-in-out, scale 0.3s ease-in-out, border 0.3s ease-in-out;
    object-fit: cover;
  }

  {{ sec_id }} .pc-orbit-item-{{ last_part }}:hover {
    z-index: 2;
  }

  {{ sec_id }} .pc-orbit-item-{{ last_part }}:hover img {
    scale: 1.5;
    border-color: {{ section.settings.secondary_color }};
    box-shadow: 0 0 {{ section.settings.hover_glow }}px {{ section.settings.secondary_color }};
  }

  {{ sec_id }} .pc-orbit-item-{{ last_part }}:hover ~ .pc-orbit-item-{{ last_part }} img {
    scale: 0.6;
  }

  {{ sec_id }} .pc-orbit-item-{{ last_part }}:has(~ .pc-orbit-item-{{ last_part }}:hover) img {
    scale: 0.6;
  }

  {{ sec_id }} .pc-orbit-container-{{ last_part }}::before {
    content: "";
    z-index: -1;
    border: inherit;
    position: absolute;
    width: var(--size);
    aspect-ratio: 1 / 1;
    border-radius: 0.25rem;
    inset-block-start: 50%;
    inset-inline-start: 50%;
    transform: translate(-50%, -50%);
    transition: transform 0.3s ease-in-out, border-radius 0.3s ease-in-out, border 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
  }

  {{ sec_id }} .pc-orbit-container-{{ last_part }}::after {
    content: "";
    z-index: -1;
    inset: -{{ section.settings.border_width }}px;
    width: inherit;
    height: inherit;
    border: inherit;
    position: absolute;
    border-radius: inherit;
    animation: pc-spin-in-{{ last_part }} var(--duration) linear infinite reverse;
    transition: scale 0.3s ease-in-out, border-radius 0.3s ease-in-out, border 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
  }

  {{ sec_id }} .pc-orbit-container-{{ last_part }}:has(.pc-orbit-item-{{ last_part }}:hover) {
    animation-play-state: paused;
    box-shadow: 0 0 {{ section.settings.hover_glow }}px {{ section.settings.hover_glow | divided_by: 5 }}px {{ section.settings.primary_color }} inset,
      0 0 {{ section.settings.hover_glow | divided_by: 3 }}px {{ section.settings.hover_glow | divided_by: 4 }}px {{ section.settings.body_color }};
  }

  {{ sec_id }} .pc-orbit-container-{{ last_part }}:has(.pc-orbit-item-{{ last_part }}:hover) .pc-orbit-item-{{ last_part }} {
    animation-play-state: paused;
  }

  {{ sec_id }} .pc-orbit-container-{{ last_part }}:has(.pc-orbit-item-{{ last_part }}:hover)::before {
    --scale: 4;
    --translate: calc(-50% / var(--scale));
    border-width: 2px;
    border-radius: inherit;
    border-color: {{ section.settings.secondary_color }};
    transform: scale(var(--scale)) translate(var(--translate), var(--translate));
    box-shadow: 0 0 {{ section.settings.hover_glow | divided_by: 4 }}px {{ section.settings.secondary_color }},
      0 0 {{ section.settings.hover_glow | divided_by: 4 }}px {{ section.settings.primary_color }} inset;
  }

  {{ sec_id }} .pc-orbit-container-{{ last_part }}:has(.pc-orbit-item-{{ last_part }}:hover)::after {
    scale: 0.3;
    border-width: {{ section.settings.border_width | times: 3 }}px;
    border-radius: 3rem;
    border-color: {{ section.settings.secondary_color }};
    box-shadow: 0 0 var(--size) {{ section.settings.secondary_color }} inset;
  }

  @keyframes pc-spin-out-{{ last_part }} {
    from {
      rotate: 0;
    }
    to {
      rotate: 360deg;
    }
  }

  @keyframes pc-spin-in-{{ last_part }} {
    from {
      transform: rotate(0);
    }
    to {
      transform: rotate(360deg);
    }
  }

  @media (max-width: 768px) {
    {{ sec_id }} {
      padding: {{ section.settings.mobile_padding }}px;
    }
    {{ sec_id }} .pc-orbit-container-{{ last_part }} {
      --size: {{ section.settings.image_size_mobile }}px;
    }
  }
</style>

<div class="pc-orbit-container-{{ last_part }}">
  {% for block in section.blocks %}
    <div class="pc-orbit-item-{{ last_part }}" {{ block.shopify_attributes }}>
      {%- if block.settings.image != blank -%}
        {% assign image_class = 'pc-orbit-image-' | append: last_part %}
        {{ 
          block.settings.image 
          | image_url: width: 600 
          | image_tag: 
              loading: 'lazy', 
              class: image_class,
              alt: block.settings.image.alt 
        }}
      {%- else -%}
        {{ 'product-' | append: forloop.index | placeholder_svg_tag: 'placeholder-svg' }}
      {%- endif -%}
    </div>
  {% endfor %}
</div>

<script>
  document.querySelectorAll('{{ sec_id }} .pc-orbit-item-{{ last_part }}').forEach((item, index) => {
    item.style.setProperty('--i', index + 1);
  });
</script>

{% schema %}
{
  "name": "PWC - Image Animation #1",
  "max_blocks": 12,
  "settings": [
    {
      "type": "header",
      "content": "Color Settings"
    },
    {
      "type": "color",
      "id": "body_color",
      "label": "Background Color",
      "default": "#010c15"
    },
    {
      "type": "color",
      "id": "primary_color",
      "label": "Primary Color",
      "default": "#20c863"
    },
    {
      "type": "color",
      "id": "secondary_color",
      "label": "Secondary Color",
      "default": "#d4ff00"
    },
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "range",
      "id": "animation_duration",
      "label": "Animation Duration",
      "min": 5,
      "max": 60,
      "step": 1,
      "unit": "s",
      "default": 30
    },
    {
      "type": "range",
      "id": "image_size",
      "label": "Image Size (Desktop)",
      "min": 50,
      "max": 300,
      "step": 10,
      "unit": "px",
      "default": 120
    },
    {
      "type": "range",
      "id": "image_size_mobile",
      "label": "Image Size (Mobile)",
      "min": 30,
      "max": 200,
      "step": 10,
      "unit": "px",
      "default": 80
    },
    {
      "type": "range",
      "id": "orbit_offset",
      "label": "Orbit Offset",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 30
    },
    {
      "type": "range",
      "id": "border_width",
      "label": "Border Width",
      "min": 1,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 6
    },
    {
      "type": "range",
      "id": "image_border_width",
      "label": "Image Border Width",
      "min": 1,
      "max": 10,
      "step": 1,
      "unit": "px",
      "default": 3
    },
    {
      "type": "range",
      "id": "hover_glow",
      "label": "Hover Glow Intensity",
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 60
    },
    {
      "type": "header",
      "content": "Spacing Settings"
    },
    {
      "type": "range",
      "id": "desktop_padding",
      "label": "Desktop Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "mobile_padding",
      "label": "Mobile Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 10
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Orbit Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "PWC - Image Animation #1",
      "category": "Custom",
      "blocks": [
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        }
      ]
    }
  ]
}
{% endschema %}