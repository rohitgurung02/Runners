{%- assign sec_id = '#shopify-section-' | append: section.id -%}
{%- assign parts = sec_id | split: '_' -%}
{%- assign last_lower = parts | last -%}
{%- assign last_part = last_lower | downcase -%}

<style>
  {{ sec_id }} {
    background-color: {{ section.settings.background_color }};
    padding-top: {{ section.settings.desktop_padding_top }}px;
    padding-bottom: {{ section.settings.desktop_padding_bottom }}px;
  }

  {{ sec_id }} .pc-carousel-{{ last_part }} {
    position: relative;
    width: 100%;
    height: calc(var(--pc-item-height) + 20px);
    overflow: hidden;
    mask-image: linear-gradient(to right, transparent, #000 10% 90%, transparent);
    margin: 0 auto;
  }

  {{ sec_id }} .pc-carousel-container-{{ last_part }} {
    display: flex;
    width: max-content;
    height: 100%;
    position: relative;
  }

  {{ sec_id }} .pc-carousel-item-{{ last_part }} {
    width: var(--pc-item-width);
    height: var(--pc-item-height);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    position: absolute;
    left: 100%;
    animation: pc-slide-{{ last_part }} var(--pc-animation-duration) linear infinite;
    animation-delay: calc((var(--pc-animation-duration) / var(--pc-item-quantity)) * (var(--pc-item-position) - var(--pc-item-quantity)));
  }

  {{ sec_id }} .pc-carousel-{{ last_part }}[data-reverse="true"] .pc-carousel-item-{{ last_part }} {
    animation: pc-slide-reverse-{{ last_part }} var(--pc-animation-duration) linear infinite;
  }

  {{ sec_id }} .pc-carousel-{{ last_part }}:hover .pc-carousel-item-{{ last_part }} {
    animation-play-state: paused;
  }

  {{ sec_id }} .pc-carousel-img-{{ last_part }} {
    width: auto;
    height: auto;
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    filter: grayscale(100%);
    opacity: 0.7;
    transition: all 0.3s ease;
  }

  {{ sec_id }} .pc-carousel-img-{{ last_part }}:hover {
    filter: grayscale(0%);
    opacity: 1;
  }

  @keyframes pc-slide-{{ last_part }} {
    from {
      left: 100%;
    }
    to {
      left: calc(var(--pc-item-width) * -1);
    }
  }

  @keyframes pc-slide-reverse-{{ last_part }} {
    from {
      left: calc(var(--pc-item-width) * -1);
    }
    to {
      left: 100%;
    }
  }

  @media (max-width: 749px) {
    {{ sec_id }} {
      padding-top: {{ section.settings.mobile_padding_top }}px;
      padding-bottom: {{ section.settings.mobile_padding_bottom }}px;
    }
    
    {{ sec_id }} .pc-carousel-{{ last_part }} {
      --pc-item-width: {{ section.settings.mobile_item_width }}px;
      --pc-item-height: {{ section.settings.mobile_item_height }}px;
    }
  }

  @media (min-width: 750px) {
    {{ sec_id }} .pc-carousel-{{ last_part }} {
      --pc-item-width: {{ section.settings.desktop_item_width }}px;
      --pc-item-height: {{ section.settings.desktop_item_height }}px;
    }
  }
</style>

<div class="pc-carousel-wrapper-{{ last_part }}">
  {% if section.settings.show_heading and section.settings.heading != blank %}
    <h2 class="pc-carousel-heading-{{ last_part }}" style="
      font-size: {{ section.settings.heading_font_size_desktop }}px;
      color: {{ section.settings.heading_color }};
      margin-bottom: {{ section.settings.heading_margin_bottom }}px;
      {% if section.settings.heading_shadow %}text-shadow: 1px 1px 3px rgba(0,0,0,0.3);{% endif %}
      text-align: center;
    ">
      {{ section.settings.heading }}
    </h2>
  {% endif %}
  
  <div class="pc-carousel-{{ last_part }}" 
       data-reverse="{{ section.settings.reverse_direction }}"
       style="--pc-item-quantity: {{ section.blocks.size }}; 
              --pc-animation-duration: {{ section.settings.animation_duration }}s">
    <div class="pc-carousel-container-{{ last_part }}">
      {% for block in section.blocks %}
        {% if block.settings.image != blank %}
          <div class="pc-carousel-item-{{ last_part }}" style="--pc-item-position: {{ forloop.index }}">
            {{ block.settings.image | image_url: width: 400 | image_tag: 
              class: 'pc-carousel-img-' | append: last_part, 
              loading: 'lazy', 
              alt: block.settings.image.alt | escape 
            }}
          </div>
        {% else %}
          <div class="pc-carousel-item-{{ last_part }}" style="--pc-item-position: {{ forloop.index }}">
            {{ 'product-' | append: forloop.index | placeholder_svg_tag: 'pc-carousel-img-' | append: last_part }}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "PWC - Brand Carousel #1",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "range",
      "id": "animation_duration",
      "label": "Animation Duration (seconds)",
      "min": 5,
      "max": 60,
      "step": 1,
      "default": 15
    },
    {
      "type": "checkbox",
      "id": "reverse_direction",
      "label": "Reverse Animation Direction",
      "default": false
    },
    {
      "type": "header",
      "content": "Desktop Settings"
    },
    {
      "type": "range",
      "id": "desktop_item_width",
      "label": "Item Width (Desktop)",
      "min": 50,
      "max": 300,
      "step": 10,
      "unit": "px",
      "default": 120
    },
    {
      "type": "range",
      "id": "desktop_item_height",
      "label": "Item Height (Desktop)",
      "min": 20,
      "max": 200,
      "step": 5,
      "unit": "px",
      "default": 60
    },
    {
      "type": "header",
      "content": "Mobile Settings"
    },
    {
      "type": "range",
      "id": "mobile_item_width",
      "label": "Item Width (Mobile)",
      "min": 40,
      "max": 200,
      "step": 5,
      "unit": "px",
      "default": 80
    },
    {
      "type": "range",
      "id": "mobile_item_height",
      "label": "Item Height (Mobile)",
      "min": 15,
      "max": 150,
      "step": 5,
      "unit": "px",
      "default": 40
    },
    {
      "type": "header",
      "content": "Content Settings"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Trusted by these brands"
    },
    {
      "type": "checkbox",
      "id": "show_heading",
      "label": "Show Heading",
      "default": false
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "heading_font_size_desktop",
      "label": "Heading Font Size (Desktop)",
      "min": 12,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "heading_font_size_mobile",
      "label": "Heading Font Size (Mobile)",
      "min": 10,
      "max": 30,
      "step": 1,
      "unit": "px",
      "default": 18
    },
    {
      "type": "range",
      "id": "heading_margin_bottom",
      "label": "Heading Bottom Margin",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 20
    },
    {
      "type": "checkbox",
      "id": "heading_shadow",
      "label": "Heading Text Shadow",
      "default": false
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "desktop_padding_top",
      "label": "Top Padding (Desktop)",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "desktop_padding_bottom",
      "label": "Bottom Padding (Desktop)",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "mobile_padding_top",
      "label": "Top Padding (Mobile)",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "mobile_padding_bottom",
      "label": "Bottom Padding (Mobile)",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 20
    }
  ],
  "blocks": [
    {
      "type": "brand",
      "name": "Brand",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Brand Logo"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "PWC - Brand Carousel #1",
      "blocks": [
        {
          "type": "brand"
        },
        {
          "type": "brand"
        },
        {
          "type": "brand"
        },
        {
          "type": "brand"
        },
        {
          "type": "brand"
        },
        {
          "type": "brand"
        }
      ]
    }
  ]
}
{% endschema %}