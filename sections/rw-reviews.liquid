{%- assign sec_id = '#shopify-section-' | append: section.id -%}
{%- assign parts = sec_id | split: '_' -%}
{%- assign last_lower = parts | last -%}
{%- assign last_part = last_lower | downcase -%}

<pc-testimonial-slider-{{ last_part }} class="pc-testimonial-slider-{{ last_part }}">
  <div class="pc-testimonial-slider__container">
    <div class="pc-testimonial-slider__holder">
      <div class="pc-testimonial-slider__image">
        {%- for block in section.blocks -%}
          <div class="pc-testimonial-slide__img {% if forloop.first %}active{% endif %}" 
               style="background-image: url('{{ block.settings.image | img_url: '800x' }}')">
          </div>
        {%- endfor -%}
      </div>
      
      <div class="pc-testimonial-slider__right"></div>
      
      <div class="pc-testimonial-slider__text">
        <div class="pc-testimonial-slider__center-text">
          {%- for block in section.blocks -%}
            <div class="pc-testimonial-slide__quote {% if forloop.first %}active{% endif %}">
              <svg width="30" height="30" viewBox="0 0 24 24" fill="{{ section.settings.quote_color }}" class="pc-testimonial-quote-left">
                <path d="M3.691 16c.765 1.527 1.837 2.653 3.217 3.378 1.38.726 3.064 1.089 5.052 1.089 1.88 0 3.526-.382 4.938-1.146s2.496-1.835 3.313-3.203c.816-1.367 1.224-2.922 1.224-4.664 0-1.742-.408-3.297-1.224-4.664-.817-1.368-1.901-2.432-3.253-3.193S13.64 3 11.76 3c-1.68 0-3.202.353-4.566 1.06-1.363.707-2.446 1.673-3.248 2.9L6.741 8.4c.64-1.117 1.486-1.974 2.539-2.572 1.052-.597 2.24-.896 3.562-.896 1.488 0 2.752.38 3.792 1.139 1.04.759 1.56 1.808 1.56 3.147 0 1.339-.52 2.388-1.56 3.147-1.04.76-2.304 1.139-3.792 1.139-.544 0-1.077-.053-1.599-.16a9.388 9.388 0 0 1-1.527-.48c-.272-.107-.504-.203-.696-.288-.192-.085-.344-.16-.456-.224l-.744 3.184z"/>
              </svg>
              {{ block.settings.quote }}
              <svg width="30" height="30" viewBox="0 0 24 24" fill="{{ section.settings.quote_color }}" class="pc-testimonial-quote-right">
                <path d="M20.309 16c-.765 1.527-1.837 2.653-3.217 3.378-1.38.726-3.064 1.089-5.052 1.089-1.88 0-3.526-.382-4.938-1.146S3.432 17.835 2.615 16.467C1.8 15.1 1.392 13.542 1.392 11.8c0-1.742.408-3.297 1.224-4.664.816-1.368 1.901-2.432 3.253-3.193S9.88 3 11.76 3c1.68 0 3.202.353 4.566 1.06 1.363.707 2.446 1.673 3.248 2.9L17.259 8.4c-.64-1.117-1.486-1.974-2.539-2.572-1.052-.597-2.24-.896-3.562-.896-1.488 0-2.752.38-3.792 1.139-1.04.759-1.56 1.808-1.56 3.147 0 1.339.52 2.388 1.56 3.147 1.04.76 2.304 1.139 3.792 1.139.544 0 1.077-.053 1.599-.16.521-.107.992-.243 1.413-.407.42-.165.776-.309 1.065-.432.29-.123.512-.229.665-.319l.744 3.184z"/>
              </svg>
            </div>
          {%- endfor -%}
        </div>
        
        <div class="pc-testimonial-slider__nav">
          <button class="pc-testimonial-slider__prev" aria-label="Previous testimonial">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="{{ section.settings.nav_color }}" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 18L9 12L15 6" stroke="{{ section.settings.nav_color }}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <div class="pc-testimonial-slider__dots">
            {%- for block in section.blocks -%}
              <div class="pc-testimonial-slider__dot {% if forloop.first %}active{% endif %}"></div>
            {%- endfor -%}
          </div>
          <button class="pc-testimonial-slider__next" aria-label="Next testimonial">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="{{ section.settings.nav_color }}" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 6L15 12L9 18" stroke="{{ section.settings.nav_color }}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
    
    <div class="pc-testimonial-slider__bg">
      {%- for block in section.blocks -%}
        <div class="pc-testimonial-slide__bg {% if forloop.first %}active{% endif %}" 
             style="background-image: url('{{ block.settings.background_image | img_url: '2000x' }}')">
        </div>
      {%- endfor -%}
    </div>
  </div>
</pc-testimonial-slider-{{ last_part }}>

<style>
  {{ sec_id }} .pc-testimonial-slider-{{ last_part }} {
    width: 100%;
    min-height: 500px;
    height: 100vh;
    position: relative;
    background: {{ section.settings.background_color }};
    overflow: hidden;
  }

  {{ sec_id }} .pc-testimonial-slider__container {
    max-width: 700px;
    width: 98%;
    min-height: 360px;
    height: 360px;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    margin: auto;
  }

  {{ sec_id }} .pc-testimonial-slider__holder {
    width: 100%;
    height: 100%;
    position: relative;
  }

  {{ sec_id }} .pc-testimonial-slider__image {
    width: 40%;
    height: 100%;
    float: left;
    position: relative;
    z-index: 200;
    box-shadow: 0px 40px 120px 0px rgba(0,0,0,0.52);
    overflow: hidden;
  }

  {{ sec_id }} .pc-testimonial-slider__right {
    width: 60%;
    height: 100%;
    float: right;
    position: relative;
  }

  {{ sec_id }} .pc-testimonial-slider__text {
    width: 60%;
    height: 320px;
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    margin: auto;
    z-index: 100;
    background: {{ section.settings.text_bg_color }};
    box-shadow: 0px 40px 120px 0px rgba(0,0,0,0.52);
  }

  {{ sec_id }} .pc-testimonial-slider__center-text {
    width: 100%;
    height: 200px;
    position: absolute;
    top: 20%;
    margin-top: -100px;
    padding: 10px 0;
    overflow: hidden;
  }

  {{ sec_id }} .pc-testimonial-slide__quote {
    width: 100%;
    height: 150px;
    position: absolute;
    top: 45px;
    left: 0;
    right: -150px;
    bottom: 0;
    margin: auto;
    font-size: {{ section.settings.text_font_size }}px;
    color: {{ section.settings.text_color }};
    padding: 0 25px;
    text-align: center;
    opacity: 0;
    transition: all 2s cubic-bezier(0.86, 0.3, 0.03, 1), opacity 0.7s cubic-bezier(0.86, 0.3, 0.47, 1) 0.3s;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  {{ sec_id }} .pc-testimonial-slide__quote.active {
    right: 0;
    opacity: 1;
  }

  {{ sec_id }} .pc-testimonial-slide__img {
    width: 100%;
    height: 100%;
    position: absolute;
    right: -100%;
    background-position: center;
    background-size: cover;
    background-repeat: no-repeat;
    opacity: 0;
    z-index: 400;
    transition: all 2s cubic-bezier(0.86, 0.3, 0.03, 1), opacity 0.7s cubic-bezier(0.86, 0.3, 0.47, 1) 0.3s;
  }

  {{ sec_id }} .pc-testimonial-slide__img.active {
    right: 0;
    opacity: 1;
    z-index: 500;
  }

  {{ sec_id }} .pc-testimonial-slider__nav {
    width: 140px;
    height: 50px;
    position: absolute;
    bottom: 0;
    left: 50%;
    margin: 0 0 -25px -70px;
    z-index: 1000;
    box-shadow: 0px 7px 24px 3px rgba(0,0,0,0.52);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
  }

  {{ sec_id }} .pc-testimonial-slider__prev,
  {{ sec_id }} .pc-testimonial-slider__next {
    background: none;
    border: none;
    cursor: pointer;
    color: {{ section.settings.nav_color }};
    padding: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  {{ sec_id }} .pc-testimonial-slider__dots {
    display: flex;
    gap: 10px;
  }

  {{ sec_id }} .pc-testimonial-slider__dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: {{ section.settings.dot_color }};
    opacity: 0.3;
    cursor: pointer;
    transition: opacity 0.3s ease;
  }

  {{ sec_id }} .pc-testimonial-slider__dot.active {
    opacity: 1;
  }

  {{ sec_id }} .pc-testimonial-slider__bg {
    width: 100%;
    height: 100%;
    position: absolute;
    z-index: -1;
  }

  {{ sec_id }} .pc-testimonial-slide__bg {
    width: 100%;
    height: 100%;
    position: absolute;
    opacity: 0;
    transition: all 1.5s ease;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }

  {{ sec_id }} .pc-testimonial-slide__bg.active {
    opacity: 1;
  }

  {{ sec_id }} .pc-testimonial-quote-left,
  {{ sec_id }} .pc-testimonial-quote-right {
    margin: 0 auto;
  }

  {{ sec_id }} .pc-testimonial-quote-left {
    margin-bottom: 15px;
  }

  {{ sec_id }} .pc-testimonial-quote-right {
    margin-top: 15px;
  }

  @media screen and (max-width: 700px) {
    {{ sec_id }} .pc-testimonial-slider__container {
      width: 100%;
      min-height: 360px;
      height: 100%;
    }

    {{ sec_id }} .pc-testimonial-slider__image {
      width: 220px;
      height: 250px;
      float: none;
      position: absolute;
      top: 50%;
      left: 50%;
      margin-top: -280px;
      margin-left: -110px;
    }

    {{ sec_id }} .pc-testimonial-slider__right {
      width: 100%;
      height: 100%;
      float: none;
    }

    {{ sec_id }} .pc-testimonial-slider__text {
      width: 90%;
      height: 320px;
      top: 150px;
      left: 0;
      right: 0;
    }

    {{ sec_id }} .pc-testimonial-slider__center-text {
      top: 30%;
      padding: 150px 0 !important;
    }
  }

  @media screen and (max-width: 450px) {
    {{ sec_id }} .pc-testimonial-slider__image {
      width: 200px;
      height: 230px;
      margin-top: -250px;
      margin-left: -100px;
    }

    {{ sec_id }} .pc-testimonial-slider__text {
      width: 100%;
    }

    {{ sec_id }} .pc-testimonial-slider__center-text {
      padding: 120px 0 !important;
    }
  }
</style>

<script>
  class PCTestimonialSlider{{ last_part | capitalize }} extends HTMLElement {
    constructor() {
      super();
      this.slides = this.querySelectorAll('.pc-testimonial-slide__img, .pc-testimonial-slide__quote, .pc-testimonial-slide__bg');
      this.dots = this.querySelectorAll('.pc-testimonial-slider__dot');
      this.prevBtn = this.querySelector('.pc-testimonial-slider__prev');
      this.nextBtn = this.querySelector('.pc-testimonial-slider__next');
      this.currentIndex = 0;
      this.autoSlideInterval = null;
      this.autoSlideDelay = {{ section.settings.auto_slide_delay | default: 4500 }};

      this.initSlider();
      this.setupEventListeners();
      this.startAutoSlide();
    }

    initSlider() {
      if (this.slides.length <= 1) {
        this.prevBtn.style.display = 'none';
        this.nextBtn.style.display = 'none';
        this.querySelector('.pc-testimonial-slider__dots').style.display = 'none';
      }
    }

    setupEventListeners() {
      this.prevBtn.addEventListener('click', () => this.prevSlide());
      this.nextBtn.addEventListener('click', () => this.nextSlide());

      this.dots.forEach((dot, index) => {
        dot.addEventListener('click', () => this.goToSlide(index));
      });
    }

    startAutoSlide() {
      if (this.slides.length > 1) {
        this.autoSlideInterval = setInterval(() => {
          this.nextSlide();
        }, this.autoSlideDelay);
      }
    }

    resetAutoSlide() {
      clearInterval(this.autoSlideInterval);
      this.startAutoSlide();
    }

    updateSlider() {
      // Update slides
      this.slides.forEach((slide, index) => {
        slide.classList.toggle('active', index === this.currentIndex);
      });

      // Update dots
      this.dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === this.currentIndex);
      });
    }

    prevSlide() {
      this.currentIndex = (this.currentIndex - 1 + this.slides.length / 3) % (this.slides.length / 3);
      this.updateSlider();
      this.resetAutoSlide();
    }

    nextSlide() {
      this.currentIndex = (this.currentIndex + 1) % (this.slides.length / 3);
      this.updateSlider();
      this.resetAutoSlide();
    }

    goToSlide(index) {
      this.currentIndex = index;
      this.updateSlider();
      this.resetAutoSlide();
    }
  }

  customElements.define('pc-testimonial-slider-{{ last_part }}', PCTestimonialSlider{{ last_part | capitalize }});
</script>

{% schema %}
{
  "name": "RW- Testimonial Slider #2",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Slider Settings"
    },

    
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#e2e2e2"
    },
    {
      "type": "color",
      "id": "text_bg_color",
      "label": "Text Background Color",
      "default": "rgba(255, 255, 255, 0.57)"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#232323"
    },
    {
      "type": "range",
      "id": "text_font_size",
      "label": "Text Font Size",
      "min": 12,
      "max": 30,
      "step": 1,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "quote_color",
      "label": "Quote Mark Color",
      "default": "#0000ff"
    },
    {
      "type": "color",
      "id": "nav_color",
      "label": "Navigation Color",
      "default": "#232323"
    },
    {
      "type": "color",
      "id": "dot_color",
      "label": "Dot Color",
      "default": "#232323"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Profile Image"
        },
        {
          "type": "image_picker",
          "id": "background_image",
          "label": "Background Image"
        },
        {
          "type": "richtext",
          "id": "quote",
          "label": "Testimonial Quote",
          "default": "<p>CodePen is a social development environment. At its heart, it allows you to write code in the browser, and see the results of it as you build. A useful and liberating online code editor for developers of any skill, and particularly empowering for people learning to code. We focus primarily on front-end languages like HTML, CSS, JavaScript, and preprocessing syntaxes that turn into those things.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "RW - Testimonial Slider #2",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "quote": "<p>CodePen is a social development environment. At its heart, it allows you to write code in the browser, and see the results of it as you build. A useful and liberating online code editor for developers of any skill, and particularly empowering for people learning to code.</p>"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "quote": "<p>We say social, because CodePen is a community. Most creations on CodePen are public and open source. They are living things that other people and the community can interact with, from a simple hearting, to leaving a comment, to forking and changing for their own needs.</p>"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "quote": "<p>People use CodePen for all sorts of things: prototyping new ideas, reduced test cases for bugs, sending clients things to look at, evaluating potential hires, to finding inspiration. People also use CodePen as a sort of resume and portfolio, showing off their best design and development work.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}